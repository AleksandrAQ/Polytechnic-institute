<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0050)lesson018.htm -->
<HTML><HEAD><TITLE>Програмирование на Visual C++</TITLE>
</HEAD>
<BODY background="../bgrwhite.gif">

      <CENTER><B>Урок VIII</B></CENTER></FONT>
      <P>
      <P align=center><FONT color=black face=ARIAL size=4>Проектирование 
      диалоговой панели</FONT></P>
Сейчас мы визуально 
            спроектируем диалоговую панель. Для этого вначале выбирете закладку 
            <B>"Resourse View"</B> и раскройте пункт <B>PointORama Resource</B>, 
            как показано на рис. 1.5. 
            <P align=center><IMG 
            src="lesson018.files/vc_resourceview_point_dlg.gif"></P>Выполните 
            слдеующие действия <BR>
            <UL type=square>
              <LI>Щелкните два раза по надписи <B>IDD_PAINTORAMA_DIALOG</B>. 
              Справа появится окно проектирования диалоговой панели. 
              <LI>
              <LI>С помощью панели <B>Controls</B> расставьте элементы, 
              управления как показано на рис. 2.0 и согласно таблице 2.0. 
              <P align=center><IMG 
              src="lesson018.files/vc_resource_dlg_proekt2.gif"></P>
              <P align=center><FONT color=red><B>Таблица 2.0</B></FONT></P>
              <DIV align=center>
              <TABLE bgColor=#ffffbb border=1 cellPadding=0 cellSpacing=0 
              width="80%">
                <TBODY>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Объект</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>Свойство</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>Установка</B></FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Dialog Box</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID</B></FONT></TD>
                  <TD><FONT face=ARIAL 
                    size=2><B>IDD_PAINTORAMA_DIALOG</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Caption</FONT></TD>
                  <TD><FONT face=ARIAL size=2>The PaintORama 
                Program</FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Font</FONT></TD>
                  <TD><FONT face=ARIAL size=2>System, Size 10, страница 
                    Styles</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Picture</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>IDC_CANVAS</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Type</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Frame</FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Color</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Gray, страница 
                Styles</FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Sunken</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Отмечен, страница 
                  Styles</FONT></TD></TR></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Client edge</FONT></TD>
                  <TD><FONT face=ARIAL size=2>отмечен, страница Extended 
                    Styles</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Push Button</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID<B></FONT></B></B></TD>
                  <TD><FONT face=ARIAL size=2><B>IDC_CLEARBTN</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Caption</FONT></TD>
                  <TD><FONT face=ARIAL 
              size=2>&amp;Clear</FONT></TD></TR></TBODY></TABLE></DIV>
              <P><BR>
              <P></P>
              <LI>Думаю здесь все должно быть понятно. Только хотелось пояснить, 
              для чего мы установили флажок на <B>Notify</B> 
              <LI>В объекте <B>Dialog Box</B> вы задаете следующие 
              данные:<BR><B>Caption</B> - название диалогового 
              окна.<BR><B>Font</B> - здесь вы уcтановили шрифт -<B>System</B> и 
              его размер <B>10</B><BR>
              <LI>Когда будете раставлять элемент <B>Picture</B>, задайте ему 
              размер <B>251x258</B>, который можно посмотреть в строке 
              состояния, справа. 
              <LI>Тип элемента <B>Picture</B> - <B>Frame</B> указывает на то, 
              что внутри него будет распологаться пустой экран, в котором мы 
              будем рисовать. 
              <LI>Начальное значение цвета заливки области нашего 
              рисавания(клиентской области) устанвливается в <B>Gray</B>. 
              <LI>Остальные параметры устанавливают вид области. 
              <LI>Кнопка <B>Clear</B> предназначена для очитки рабочей области. 
              <P></P></LI></UL>
            <UL type=square>
              <P><FONT color=red size=+1><B>Связывание кода с событием BN_CLICKED 
              кнопки Clear</B></FONT></P>При нажатии на кнопку <B>Clear</B> 
              программа <B>PaintORama</B> должна очистить экран(область 
              рисования). 
              <LI>Для этого нам необходимо определить размеры этого окна и 
              сохранить их в перемнной <B>m_Canvas</B>. 
              <LI>Выполните следующие шаги:<BR><B>1)</B> Откройте в 
              <B>Workspace</B> закладку <B>Class View</B>, откройте класс 
              <B>CPaintORamaDlg</B>. Вызовите контексное меню правой кнопкой 
              мыши, выбирите там <B>Add Member Variable</B>, появится такое 
              диалоговое окно: 
              <P align=center><IMG 
              src="lesson018.files/vc_res_point_addvar1.gif"></P>
              <LI>В нем вы указываете тип переменной(<B>Variable Type</B>) : 
              <B>CRect</B>, название (<B>variable Name</B>) : <B>m_Canvas</B> и 
              права доступа к ней <B>Private</B>. 
              <LI>Нажмите <B>OK</B>. 
              <LI>Переменные типа CRect, это объекты класса четырехугольников, 
              вы можете хранить в ней координаты окна, закрашивать его и многое 
              другое.
              <P><B>2)</B> После добавления переменной вам необходимо ее 
              инициализировать координатми окна. </P>
              <LI>Это нужно сделать перед выводом самого диалогового окна. Для 
              этого вам необходимо добавить следующий код в функцию 
              <B>OnInitDialog</B>. В ней вы можете инициализировать начальные 
              данные.<BR>
              <LI>Добавьте следующий код: 
              <P><B>BOOL 
              CPaintORamaDlg::OnInitDialog()<BR>{<BR>CDialog::OnInitDialog();<BR><BR>.....<BR>
              <P>///-Ваш код начинается здесь
              <P>//Получить указатель на элемент управления 
              <B>Picture</B><BR>CWnd* p_Canvas=GetDlgItem(IDC_CANVAS);
              <P>//Записать координаты окна в переменную 
              <B>m_Canvas</B><BR>p_Canvas-&gt;GetWindowRect(&amp;m_Canvas);
              <P>//Сопоставить координаты для клиентской 
              области<BR>ScreenToClient(&amp;m_Canvas);
              <P>//Изменить координаты окна<BR>m_Canvas.DeflateRect(2,2,1,1);
              <P>}<BR></B></P>
              <LI>Вначале вы получаете указатель на элемент управления, чтобы с 
              помощью него получать или изменять информацию о нем. 
              <LI>Затем вы записываете координаты в переменную <B>m_Canvas</B>. 
              <LI>Переменная <B>m_Canvas</B> содержит координаты элемента 
              <B>Picture</B> относительно экрана, а не главного окна, а в 
              программе нам необходимы координаты именно относительно клиентской 
              области, что и выполняет функция <B>ScreenToClient</B>. 
              <LI>Последний оператор нужен для того, чтобы изменить значение 
              <B>m_Canvas</B> по 2 пиксела слева и сверху, и по одному справа и 
              снизу - это то место, которое занимает рамка,иммитирующая 
              вдавленость окна, а на ней мы не должны рисовать. 
              <P></P>
              <LI>Теперь, когда координаты окна у нас получены, нам необходимо 
              связать код с кнопкой <B>Clear</B>. 
              <LI>Чтобы связать код с событием <B>BN_CLICKED</B> кнопки 
              <B>Clear</B>, выполните следующие действия: </LI></UL>
            <UL type=round>
              <LI>Выберете <B>ClassWizard</B> в меню <B>View</B> 
              <LI>Выберете закладку <B>Message Maps</B> в панели 
              <B>ClassWizard</B> 
              <LI>Используйте диалоговую панель <B>ClassWizard</B> для выбора 
              следующего события:<BR><LEFT><B>Class Name: 
              CPaintORamaDlg<BR>Object ID: IDC_CLEARBTN<BR>Messages: 
              BN_CLICKED<BR></B></LEFT>
              <LI>Щелкните на кнопку <B>Add Fucntion</B> и в раскрывшемся окне, 
              введите название функции: <B>Clearbtn</B> нажмите кнопку 
              <B>OK</B>. </LI></UL>
            <UL type=square>
              <LI>Нажмите кнопку <B>Edit Code</B> и напишите следующий код в 
              функции <B>OnClearbtn()</B>: 
              <P><B>void CPaintORamaDlg::OnClearbtn()<BR>{<BR>// TODO: Add your 
              control notification handler code here
              <P>////////Мой код начинается здесь///////////
              <P>//Получить указатель на контекст устройства<BR>CClientDC 
              dc(this);
              <P>//Выбрать нулевое перо<BR>dc.SelectStockObject(NULL_PEN);
              <P>//Очистить окно<BR>dc.Rectangle(m_Canvas);
              <P>////////Мой код заканчивается здесь///////////
              <P>}<BR></B></P>
              <LI>Функция <B>Clearbtn</B>, которую вы ввели очищает экран. 
              <LI>Вначале вы получили указатель на DC, теперь можно рисовать. 
              <LI>Затем вы выбираете перо, которым будете рисовать, оно нулевое 
              значит будет использоваться для закраски белый цвет. 
              <LI>Последний оператор закрашивает окно(область рисования). 
            </LI></UL>Мы связали код с кнопкой <B>Clear</B> Запустите и 
            откомпилируйте программу, убедитесь, что при нажатии на кнопку 
            <B>Clear</B> область рисования очищается.
            <P>Теперь нам необходимо добавить код выбора цвета для рисования и 
            добавить саму возможность рисовать.<BR>
            <P><BR><BR>Связывание элементов управления с событиями <A 
            href="lesson008.htm"><B 
            class=base2>&lt;-Назад</B></A> || <A 
            href="lesson028.htm"><B 
            class=base2>Дальше -&gt;</B></A> 
            <P>
            <CENTER><B><FONT color=green><A 
            href="lesson008.htm">[1]</A> 
            [2] <A 
            href="lesson028.htm">[3]</A><A 
            href="lesson038.htm">[4]</A><A 
            href="lesson048.htm">[5]</A><A 
            href="lesson058.htm">[6]</A><A 
            href="lesson068.htm">[7]</A>
			<A href="lesson078.htm">[8]</A> <A 
            href="lesson088.htm">[9]</A></B></FONT></CENTER></FONT></FONT>
<p><div align="center"><a href="lesson.htm"><img src="../soder.gif" width=120 height=31 border=0 alt=""></a></div></p>		
</BODY></HTML>
