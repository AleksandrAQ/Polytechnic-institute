<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0050)lesson068.htm -->
<HTML><HEAD><TITLE>Програмирование на Visual C++</TITLE>
</HEAD>
<BODY background="../bgrwhite.gif">
      <CENTER><B>Урок VIII</B></CENTER></FONT>
      <P>
      <P align=center><FONT color=black face=ARIAL size=4>Проектирование 
      диалоговой панели</FONT></P>

       <p>Когда же это кончится?! 
            <UL type=square>
              <LI>Сейчас нам надо добавить код выбора стиля и цвета закраски. 
              <LI>Вначале необходимо спроектировать диалоговую панель, нам нужно 
              добавить элемент списка <B>List Box</B>, индикатор цвета (элемент 
              Picture), и окошко <B>PreView</B> (элемент Picture), где будет 
              отображаться стиль закраски фигур. 
              <LI>Добавьте элементы управления на диалоговую панель, согласно 
              таблице 2.0 и рисунку 2.0. </LI></UL>
            <UL type=square>
              <P align=center><IMG 
              src="lesson068.files/vc_resource_dlg_proekt7.gif"></P>
              <P align=center><FONT color=red><B>Таблица 2.0</B></FONT></P>
              <DIV align=center>
              <TABLE bgColor=#ffffbb border=1 cellPadding=0 cellSpacing=0 
              width="80%">
                <TBODY>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Объект</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>Свойство</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>Установка</B></FONT></TD></TR>
                <TR>
                  <TD colSpan=3>&nbsp;</TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>List Box</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID</B></FONT></TD>
                  <TD><FONT face=ARIAL 
                size=2><B>IDC_BRUSHSTYLE</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Sort</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Отключено, стрница 
                  Styles</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Static Text</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID<B></FONT></B></B></TD>
                  <TD><FONT face=ARIAL size=2><B>IDC_STATIC</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Caption</FONT></TD>
                  <TD><FONT face=ARIAL size=2>&amp;Styles</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Group Box</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>IDC_STATIC</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Caption</FONT></TD>
                  <TD><FONT face=ARIAL size=2>&amp;Brush Styles</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Picture</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID</B></FONT></TD>
                  <TD><FONT face=ARIAL 
                size=2><B>IDC_BRUSHCOLOR</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Type</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Rectangle</FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Color</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Black</FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Sunken</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Отмечен, страница 
                  Styles</FONT></TD></TR></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Notify</FONT></TD>
                  <TD><FONT face=ARIAL size=2>отмечен, страница 
                  Styles</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Static Text</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID<B></FONT></B></B></TD>
                  <TD><FONT face=ARIAL size=2><B>IDC_STATIC</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Caption</FONT></TD>
                  <TD><FONT face=ARIAL size=2>&amp;Color</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Picture</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID</B></FONT></TD>
                  <TD><FONT face=ARIAL 
                size=2><B>IDC_BRUSHPREVIEW</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Type</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Rectangle</FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Color</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Black</FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Sunken</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Отмечен, страница 
                  Styles</FONT></TD></TR></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Notify</FONT></TD>
                  <TD><FONT face=ARIAL size=2>отмечен, страница 
                  Styles</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Static Text</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>ID<B></FONT></B></B></TD>
                  <TD><FONT face=ARIAL size=2><B>IDC_STATIC</B></FONT></TD></TR>
                <TR>
                  <TD></TD>
                  <TD><FONT face=ARIAL size=2>Caption</FONT></TD>
                  <TD><FONT face=ARIAL 
              size=2>&amp;PreView</FONT></TD></TR></TBODY></TABLE></DIV>
              <P><BR>
              <P>
              <LI>Вы добавили элемент управления <B>List Box</B> и отключили там 
              свойство <B>Sort</B>, это означает, что элементы этого листа будут 
              отображаться в том порядке в котором, мы их добавили, иначе они 
              будут сортироваться по имени. 
              <LI>Вы добавили два элемента <B>Picture</B>, они будут выполнять 
              ту же роль, что и индикатор цвета пера, но только элемент 
              <B>Preview</B> будет показывать, как будет выглядеть закраска. 
              <LI>Теперь разберемся, как все будет работать, когда вы выбираете 
              цвет закраски или стиль, то после этого должно закраситься окно 
              <B>Preview</B>, тем стилем и цветом, который вы выбрали из списка. 

              <LI>Сначала нам необходимо добавить несколько переменных, которые 
              будут хранит цвет окна, стиль, размеры рамок. 
              <LI>Добавьте переменные согласно таблице, используя для этого 
              <B>Workspace</B>.
              <P>
              <DIV align=center>
              <TABLE bgColor=#ffffbb border=1 cellPadding=0 cellSpacing=0 
              width="80%">
                <TBODY>
                <TR>
                  <TD><FONT face=ARIAL size=2><B>Тип</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>Название</B></FONT></TD>
                  <TD><FONT face=ARIAL size=2><B>Описание</B></FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2>CBrush</FONT></TD>
                  <TD><FONT face=ARIAL size=2>m_Brush</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Объект кисти</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2>COLORREF</FONT></TD>
                  <TD><FONT face=ARIAL size=2>m_BrushColor</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Цвет заливки</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2>CRect</FONT></TD>
                  <TD><FONT face=ARIAL size=2>m_BrushColorSwatch</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Координаты индикатора 
                    цвета</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2>CRect</FONT></TD>
                  <TD><FONT face=ARIAL size=2>m_BrushPreviewSwatch</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Координаты 
просмотра</FONT></TD></TR>
                <TR>
                  <TD><FONT face=ARIAL size=2>int</FONT></TD>
                  <TD><FONT face=ARIAL size=2>m_BrushStyle</FONT></TD>
                  <TD><FONT face=ARIAL size=2>Стиль 
                закраски</FONT></TD></TR></TBODY></TABLE></DIV>
              <P></P>
              <LI>После добаления переменных нужно инициализировать их 
              начальными значениями, добавить стили закраски в элемент <B>List 
              Box</B>. 
              <LI>Добавьте следующий код в конец функции <B>OnInitDialog</B>. 
              <P><B>//Получить указатель на элемент управления<BR>CWnd* 
              pBrushColor=GetDlgItem(IDC_BRUSHCOLOR);
              <P>//Получить координаты элемента 
              управления<BR>pBrushColor-&gt;GetWindowRect(&amp;m_BrushColorSwatch);
              <P>//Изменить координаты относительно клиентской 
              области<BR>ScreenToClient(&amp;m_BrushColorSwatch);
              <P>//Cузить рамку<BR>m_BrushColorSwatch.DeflateRect(2,2,1,1);
              <P><BR>
              <P>//Получить указатель на элемент управления<BR>CWnd* 
              pPreviewColor=GetDlgItem(IDC_BRUSHPREVIEW);
              <P>//Получить координаты элемента 
              управления<BR>pPreviewColor-&gt;GetWindowRect(&amp;m_BrushPreviewSwatch);
              <P>//Изменить координаты относительно клиентской 
              области<BR>ScreenToClient(&amp;m_BrushPreviewSwatch);
              <P>//Cузить рамку<BR>m_BrushPreviewSwatch.DeflateRect(2,2,1,1);
              <P>//Установить начальный цвет кисти<BR>m_BrusColor=RGB(0,0,0);
              <P>//Создать белую 
              кисть<BR>m_Brush.CreateStockObject(WHITE_BRUSH);<BR></B>
              <P></P>
              <LI>Думаю этот код уже должен быть понятен, так как мы его не раз 
              рассматривали прежде. Мы здесь записали координаты индикаторов в 
              переменные <B>m_BrushColorSwatch</B> и 
              <B>m_BrushPreviewSwatch</B>. 
              <LI>Вы установили начальный цвет кисти, как черный, и создали 
              белую кисть. 
              <LI>Теперь нужно связать элемент <B>ListBox</B> с переменной 
              <B>m_BrushStyleList</B>, категорией <B>Control</B>, выполните это 
              с помощью <B>Class Wizard</B>. 
              <LI>Добавим код для инициализации элемента <B>List Box</B> 
              названиями стилей в конец функции <B>OnInitDialog</B> перед 
              оператором <B>return</B> 
              <P><B>//Добавить названия стилей в элемент 
              ListBox<BR>m_BrushStyleList.AddString("(none)");<BR>m_BrushStyleList.AddString("Solid");<BR>m_BrushStyleList.AddString("LL-UR 
              Diagonal");<BR>m_BrushStyleList.AddString("UL-LR 
              Diagonal");<BR>m_BrushStyleList.AddString("Grid");<BR>m_BrushStyleList.AddString("Grid 
              Diagonal");<BR>m_BrushStyleList.AddString("Horizontal");<BR>m_BrushStyleList.AddString("Vertical");<BR>m_BrushStyleList.AddString("White");<BR>m_BrushStyleList.AddString("Light 
              Gray");<BR>m_BrushStyleList.AddString("Medium 
              Gray");<BR>m_BrushStyleList.AddString("Dark 
              Gray");<BR>m_BrushStyleList.AddString("Black");
              <P>//Установить начальную позицию курсора на 8 
              элементе<BR>m_BrushStyleList.SetCurSel(8);<BR></B></P>
              <LI>С помощью переменной управления элементом, вы добавляете 
              функцией <B>AddString</B> названия стилей. 
              <LI>Затем устанавливаете начальную позицию курсора на 8 позиции в 
              списке. 
              <LI>Теперь свяжем код с событием изменения позиции в списке стилей 
              заливки. 
              <LI>Откройте <B>ClassWizard</B> и свяжите элемент 
              <B>IDC_BRUSHSTYLE</B> с событием <B>LBN_SELCHANGE</B>. 
              <LI>Щеклните на кнопку <B>Edit Code</B> и добавьте следующий код в 
              функцию <B>OnSelchangeBrushstyle</B>:
              <P><B>//Удалить предыдущий объект<BR>m_Brush.DeleteObject();
              <P>//Получить номер выбранной позиции<BR>int 
              style=m_BrushStyleList.GetCurSel();
              <P>//По номеру создать кисть, с выбранным 
              стилем<BR>switch(style)<BR>{<BR>case 
              0:<BR>m_Brush.CreateStockObject(NULL_BRUSH);<BR>break;
              <P>case 1:<BR>m_Brush.CreateSolidBrush(m_BrushColor);<BR>break;
              <P>case 2:<BR>m_Brush.CreateHatchBrush(HS_BDIAGONAL, 
              m_BrushColor);<BR>break;
              <P>case 3:<BR>m_Brush.CreateHatchBrush(HS_FDIAGONAL, 
              m_BrushColor);<BR>break;
              <P>case 4:<BR>m_Brush.CreateHatchBrush(HS_CROSS, 
              m_BrushColor);<BR>break;
              <P>case 5:<BR>m_Brush.CreateHatchBrush(HS_DIAGCROSS, 
              m_BrushColor);<BR>break;
              <P>case 6:<BR>m_Brush.CreateHatchBrush(HS_HORIZONTAL, 
              m_BrushColor);<BR>break;
              <P>case 7:<BR>m_Brush.CreateHatchBrush(HS_VERTICAL, 
              m_BrushColor);<BR>break;
              <P>case 9:<BR>m_Brush.CreateStockObject(LTGRAY_BRUSH);<BR>break;
              <P><BR>case 
10:<BR>m_Brush.CreateStockObject(GRAY_BRUSH);<BR>break;
              <P>case 11:<BR>m_Brush.CreateStockObject(DKGRAY_BRUSH);<BR>break;
              <P>case 12:<BR>m_Brush.CreateStockObject(BLACK_BRUSH);<BR>break;
              <P>//Создать кисть по 
              умолчанию<BR>default:<BR>m_Brush.CreateStockObject(WHITE_BRUSH);<BR>break;<BR>}
              <P>//Вызвать функцию зарисовки окна 
Preview<BR>PaintBrushPreview();
              <P></B></P>
              <LI>Код, который вы добавили, вначале удаляет прдедыдущую кисть, 
              потом получает номер выбранной позиции, затем в зависимости от нее 
              создает кисть с определенным стилем. 
              <LI>В конце вызывается функция закраски окна <B>Preview</B> 
              выбранным стилем и цветом, давайте добавим ее. 
              <LI>С помощью <B>WorkSpace</B> добаьте функцию 
              <B>PaintBrushPreview</B> с типом <B>void</B> в класс 
              <B>CPaintORamaDlg</B> следующий код:
              <P><B>void CPaintORamaDlg::PaintBrushPreview()<BR>{<BR>
              <P>////-Ваш код начинается здесь-////
              <P>CClientDC 
              dc(this);<BR>dc.FillRect(&amp;m_BrushPreviewSwatch,&amp;m_Brush);
              <P>////-Ваш код заканчивается здесь-////
              <P>}
              <P></B></P>
              <LI>Теперь добавим функцию выбора цвета закраски. 
              <LI>Свяжите элемент управления <B>IDC_BRUSHCOLOR</B> с событием 
              <B>BN_CLICKED</B>, и добавьте туда следующий код:
              <P><B>void CPaintORamaDlg::OnBrushcolor() <BR>{<BR>////-Ваш код 
              начинается здесь-////
              <P>//Создать объект диалогового окна выбор цвета<BR>CColorDialog 
              dlg(m_BrushColor);
              <P>/*Если была нажата кнопка ОК, то закрасить индикатор 
              цвета*/<BR>if(dlg.DoModal()==IDOK)<BR>{<BR>m_BrushColor=dlg.GetColor();<BR>CClientDC 
              dc(this);<BR>CBrush b(m_BrushColor);
              <P>//Закрашивание индикатора цвета 
              кисти<BR>dc.FillRect(&amp;m_BrushColorSwatch,&amp;b);<BR>}
              <P>/*Запустить функцию создания кисти, выбранным 
              цветом*/<BR>OnSelchangeBrushstyle();
              <P>////-Ваш код заканчивается здесь-////
              <P>} </B></P>
              <LI>Вначале создается объект диалогового окна выбора цвета, потом, 
              если была нажата клавиша <B>OK</B>, индикатор зарисовывается 
              выбранным цветом и в конце запускается функция создания кисти 
              новым цветом. 
              <LI>Все отлично, но осталось добавить возможность выбора кисти в 
              код рисования. 
              <LI>Откройте функцию <B>DrawShape</B> и сразу же перед или после 
              оператора <B>SelectObject(&amp;m_Pen)</B>, добавьте 
              оператор<BR><B><FONT 
              color=red>SelectObject(&amp;m_Brush);</FONT></B>. 
              <LI>Этим оператором вы выбираете кисть и применяете ее к 
              рисованию. 
              <LI>Теперь можете откомпилировать программу и запустить ее. 
              Попробуйте нарисовать что-нибудь разными цветами кистей и перьев, 
              разными стилями и размерами, и фигурами. 
              <LI>Но это еще не все! Осталось решить небольшую проблему, если к 
              примеру окно вашей программы перекрыть другой, или просто его 
              сдвинуть за пределы экрана, то понадобиться перерисовка окна, так 
              как все что было сотрется. Винда не сохраняет экраны программ :(. 
              Придется все делать в ручную! 
              <P></P></LI></UL><BR><BR>Добавим возможность перерисовки экрана.<BR>
            <CENTER><A 
            href="lesson058.htm"><B 
            class=base2>&lt;-Назад</B></A> || <A 
            href="lesson078.htm"><B 
            class=base2>Дальше -&gt;</B></A>
            <P></CENTER>
            <P>
            <CENTER><B><FONT color=green><A 
            href="lesson008.htm">[1]</A><A 
            href="lesson018.htm"> [2]</A> 
            <A 
            href="lesson028.htm">[3]</A><A 
            href="lesson038.htm"> [4]</A><A 
            href="lesson048.htm"> [5] 
            </A><A 
            href="lesson058.htm">[6]</A> 
            [7] <A 
            href="lesson078.htm">[8]</A> <A 
            href="lesson088.htm">[9]</A></B></FONT></CENTER></FONT></FONT>
<p><div align="center"><a href="lesson.htm"><img src="../soder.gif" width=120 height=31 border=0 alt=""></a></div></p>		
</BODY></HTML>
