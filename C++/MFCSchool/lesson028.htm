<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0050)lesson028.htm -->
<HTML><HEAD><TITLE>Програмирование на Visual C++</TITLE>
</HEAD>
<BODY background="../bgrwhite.gif">
      <CENTER><B>Урок VIII</B></CENTER></FONT>
      <P>
      <P align=center><FONT color=black face=ARIAL size=4>Проектирование 
      диалоговой панели</FONT></P>
     
  Ну что, готовы продолжить 
            наше путешествие? Конечно, готовы. Поехали дальше! 
            <UL type=square>
              <LI>Теперь нам необходимо добавить код рисования, используйте 
              следующие инструкции для этого: 
              <LI>Вначале вам необходимо связать код с нажатием на левую кнопку 
              мыши, во-первых нам необходимо проверить было ли выполнено нажатие 
              в области рисования, во-вторых захватить мышь! </LI></UL>
            <UL type=square>
              <P><FONT color=red size=+1><B>Связывание кода с событием 
              WM_LBUTTONDOWN</B></FONT></P>
              <LI>Добавьте в класс <B>CPaintORamaDlg</B> две переменные 
              <B>m_LineEnd</B> и <B>m_LineStart</B>, тип переменных - 
              <B>CPoint</B>, доступ <B>Private</B>, если забыли, как это делать 
              вернитесь на страничку назад и посмотрите шаги для добавления 
              переменной <B>m_Cavas</B>. При нажатии на кнопку мыши программа 
              <B>PaintORama</B> должна проверить был ли выполнен щелчок в 
              области рисования, и присвоить координаты начала (X,Y) переменной 
              <B>m_LineStart</B> и <B>m_LineEnd</B>,последняя переменная будет 
              постоянно меняться, а первая будет хранить ее предыдущее значении. 

              <LI>Выполните следующие шаги:<BR><B>1)</B> Откройте в 
              <B>Workspace</B> закладку <B>Class View</B>, откройте класс 
              <B>CPaintORamaDlg</B>. Вызовите контексное меню правой кнопкой 
              мыши, выбирите там <B>Add Windows Message Handler...</B>, появится 
              такое диалоговое окно: </LI></UL>
      
              <P align=center><IMG src="lesson028.files/vc_add_func_btdown.gif"    width=440></P>
 <UL type=round>  <LI>В списке <B>Class to object to handle</B> убедитесь, что 
              выбран класс <B>CPaintORama</B> . В списке сообщений <B>New 
              Windows message/events</B> выбирите <B>WM_LBUTTONDOWN</B>. 
              <LI>Нажмите кнопку <B>Add and Edit</B>. 
              <LI>У вас появится окно редактирования, введите следующий код: 
              <P><B>BOOL CPaintORamaDlg::OnLButtonDown(UINT nFlags, CPoint 
              point) <BR>{<BR><BR>.....<BR>
              <P>/////-Ваш код начинается здесь-///
              <P>//Проверить было ли нажатие внутри области 
              рисования.<BR>if(m_Canvas.PtInRect(point))<BR>{<BR>//Присвоить 
              координаты начала двум переменным<BR>m_LineStart= 
              point;<BR>m_LineEnd=point;
              <P>//Захватить мышь<BR>SetCapture();<BR>}
              <P>/////-Ваш код заканчивается здесь-/////
              <P>}<BR></B></P>
              <LI>Оператор <B>IF</B> проверяет было ли нажатие внутри области 
              рисования, для этого используется функция <B>PtInRect</B>, 
              <LI>Если условие выполняется, то инициализировать координаты конца 
              и начала значениями текущего нажатия. 
              <LI>Последним оператором вы захватываете мышь, для того чтобы 
              сообщение, что кнопка мыши отпущена не происходило,когда вы 
              отпутили ее за жкраном программы. Координаты начала у нас получены 
              вам необходимо ввести сам код рисования. 
              <LI>Эту задачу у нас будет решать функция, которая связана с 
              сообщением о передвижении мыши. 
              <LI>Теперь нам необходимо связать код с событием 
              <B>WM_MOUSEMOVE</B>, выполните следующие действия: </LI></UL>
            <UL type=round>
              <LI>Выберете <B>ClassWizard</B> в меню <B>View</B> 
              <LI>Выберете закладку <B>Message Maps</B> в панели 
              <B>ClassWizard</B> 
              <LI>Используйте диалоговую панель <B>ClassWizard</B> для выбора 
              следующего события:<BR><LEFT><B>Class Name: 
              CPaintORamaDlg<BR>Object ID: CPaintORama<BR>Messages: 
              WM_MOUSEMOVE<BR></B></LEFT>
              <LI>Щелкните на кнопку <B>Add Fucntion</B> . </LI></UL>
            <UL type=square>
              <LI>Нажмите кнопку <B>Edit Code</B> и напишите следующий код в 
              функции <B>OnMouseMove</B>: 
              <P><B>void CPaintORamaDlg::OnMouseMove(UINT nFlags, CPoint 
              point)<BR>{<BR>////-Ваш код начинается здесь-////
              <P>if( (nFlags &amp; MK_LBUTTON) &amp;&amp; 
              m_Canvas.PtInRect(point))<BR>{
              <P>//Получить указатель на контекст устройства<BR>CClientDC 
              dc(this);
              <P>//Присвоить координаты щелчка переменной 
              m_LineEnd<BR>m_LineEnd= point;
              <P>//Нарисовать 
              линию<BR>dc.MoveTo(m_LineStart);<BR>dc.LineTo(m_LineEnd)
              <P>/*Присвоить текущее переменной m_LineStart значение позиции 
              курсора*/ <BR>m_LineStart=m_LineEnd;<BR>}
              <P>////-Ваш код закачивается здесь-////
              <P>} </B></P>
              <LI>В условии оператора <B>IF</B> программа проверяет нажата ли 
              левая кнопка и что курсор находится в области рисования. 
              <LI>Вначале вы получили указатель контекст утройства, теперь можно 
              рисовать. 
              <LI>Затем присваиваете координаты курсора переменной 
              <B>m_LineEnd</B>. 
              <LI>Потом два оператора рисуют линию, и последний оператор 
              присваивает текущее положение курсора переменной m_LineStart</B>, 
              это значение будет являться началом для следующего рисованяи линии 
              после передвижения мыши. 
              <P>
              <P><FONT color=red size=+1><B>Связывание кода с событием 
              WM_LBUTTONUP</B></FONT></P>
              <LI>При отпускании кнопки мыши программа <B>PaintORama</B> должна 
              отпустить мышь, которую мы захватили в функции 
              <B>OnLButtonDown</B>. 
              <LI>Выполните следующие шаги:<BR><B>1)</B> Откройте в 
              <B>Workspace</B> закладку <B>Class View</B>, откройте класс 
              <B>CPaintORamaDlg</B>. Вызовите контексное меню правой кнопкой 
              мыши, выбирите там <B>Add Windows Message Handler...</B>. 
              <LI>В списке <B>Class to object to handle</B> убедитесь, что 
              выбран класс <B>CPaintORama</B> . В списке сообщений <B>New 
              Windows message/events</B> выбирите <B>WM_LBUTTONUP</B>. 
              <LI>Нажмите кнопку <B>Add and Edit</B>. 
              <LI>У вас появится окно редактирования, введите следующий код: 
              <P><B>void CPaintORamaDlg::OnLButtonUp(UINT nFlags, CPoint point) 
              <BR>{<BR>////-Ваш код начинается здесь-//// 
              <P>ReleaseCapture();
              <P>////-Ваш код заканчивается здесь-////
              <P>}
              <P></B></P></LI></UL>Запустите программу и попробуйте нарисовать 
            что-нибудь. 
            <P><div align="center"><BR><BR>Добавление возможности выбора цвета пера и размера!<BR><A 
            href="lesson018.htm"><B 
            class=base2>&lt;-Назад</B></A> || <A 
            href="lesson038.htm"><B 
            class=base2>Дальше -&gt;</B></A></div> 
            <P>
            <CENTER><B><FONT color=green><A 
            href="lesson008.htm">[1]</A><A 
            href="lesson018.htm"> [2]</A> 
            [3]<A href="lesson038.htm"> 
            [4]</A><A href="lesson048.htm"> 
            [5] </A><A 
            href="lesson058.htm">[6]</A><A 
            href="lesson068.htm"> [7]<A> <A 
            href="lesson078.htm">[8]</A> <A 
            href="lesson088.htm">[9]</A></B></FONT></CENTER></FONT></FONT>
<p><div align="center"><a href="lesson.htm"><img src="../soder.gif" width=120 height=31 border=0 alt=""></a></div></p>		
</BODY></HTML>
